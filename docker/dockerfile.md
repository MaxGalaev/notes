### Теория

Dockerfile - файл с инструкциями для сборки образа. 
#### Описание команд
LABEL - добавляет метаинформацию, например автора образа. Задается в формате ключ - значение.
LABEL key1="value1" key2="value2"
LABEL author="Maxim Galalev" url="mgalaev.ru"

ENV - определяет переменные окружения, которые можно переопределить при запуске контейнера. Недоступны в момент сборки образа. Задается в формате ключ - значение.
ENV variable=value
ENV timezome=Moscow

ARG - переменные окружения на момент сборки. Позволяет параметризовать докерфайл под разные версии образа под разные окружения. Задается в формате ключ - значение. Обратиться к аргументу можно с помощью 3-его примера
ARG variable=value
ARG stand=prod
ENV run=$stand

COPY - используется для копирования файлов в образ. Копируемые данные должны находиться в одной папке с докерфайлом
COPY src dest
COPY main.go /max/main.go

ADD - используется для доставки данных в образ, но в отличие от COPY умеет распаковывать архивы, скачивать удаленные файлы. Использовать рекомендуется с четким понимаем нужной функциональности.

ADD url_src dest
ADD https://mgalaev.ru/main.go /max/main.go

RUN - используется для подготовки окружения, например обновляет пакеты, запускает shell-команды, создает директории и т.д. Аргументы команды могут передаваться 2-я методами: shell и exec

RUN shell-command
RUN apt update && apt install -y python-pip && mkdir test (shell)
RUN ["go", "build", "/max/main.go"] (exec)

WORKDIR - задает рабочую директорию внутри контейнера для последующих команд. Переход в рабочую директорию происходит автоматически.
WORKDIR path
WORKDIR /max

USER - задает пользователя под которым запускаются все последующие инструкции, такие как RUN, CMD, ENTRYPOINT. Пользователь должен быть создан заранее.
USER username
USER max

EXPOSE - указывает какой порт используется в контейнере, при этом порт не открывается автоматически. Инструкци носит информационный характер.
EXPOSE port/type
EXPOSE 80/tcp

CMD и ENTRYPOINT - определяют команду корневого процесса в контейнере. Аргументы команды могут передаваться 2-я методами: shell и exec. 
При использовании метода shell, команда запускается в оболочке окружения(например bash), а в exec форме запускается только сама команда с аргументами. 
Второй вариант вроде как предпочтительнее, потому что не ломает принцип один процесс - один контейнер. Инструкция CMD может быть только одна на весь докерфайл, если их несколько то применится только последняя.
При этом CMD можно переопределить в момент запуска контейнера docker run image cmd_command. ENTRYPOINT нельзя переопределить в момент запуска контейнера, а переданное значение добавляется к команде в ENTRYPOINT.
Инструкции CMD и ENTRYPOINT можно использовать совместно. Их поведение будет зависить от формы записи. Если в ENTRYPOINT используется shell форма, то CMD будет полность проигнорирована. Если обе инструкции используют
exec форму, то CMD добавится к ENTRYPOINT. Если нужно переопределить ENTRYPOINT при запуске контейнера, то это можно сделать указав флаг --entrypoint в команде docker run (docker run --entrypoint ["/bin/app"] image)

CMD sleep infinity (shell)
CMD ["/bin/bash", "-c", "sleep infinity"] (exec)
CMD ["/bin/sleep", "infinity"] (exec)

ENTRYPOINT ["/bin/sleep"]
docker run image infinity

CMD и ENTRYPOINT обе определяют, какая команда будет выполнена при запуске Docker-контейнера, но делают это по-разному. CMD лучше использовать для задания параметров по умолчанию, которые могут быть изменены, 
а ENTRYPOINT для установки фиксированной базовой команды, к которой можно добавлять аргументы.

HEALTHCHECK - добавляет проверку состояния контейнера с помощью дополнительных опций, например интервал проверки, таймаут, время на запуск, кол-во попыток старта.
HEALTHCHECK \
--interval 2m \
--timeout 10s \
--start-period 3m \
--retries 5 \
CMD curl --fail http://localhost || exit 1

#### Сборка образа

```shell
docker build -t image:tag .
```
-t - имя и тэг образа
```shell
docker build --build-arg PARAM=VALUE -t image:tag .
```
позволяет переопределить ARG
