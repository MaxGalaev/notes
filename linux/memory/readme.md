### Работа с памятью в линукс

#### Теория:

Виртуальная память - это абстракция операционной системы для аллокации оперативной памяти процессу. Виртуальная память используется для изоляции процессов друг от друга. Каждый процесс имеет свое адресное пространство и думает что он системе один. Когда процесс начинает писать данные в память, в этот момент память фактически выделяется и ОС строит таблицу соответствия виртуальной памяти с физической. Виртуальной памяти может быть больше чем физической. 

#### Файловый кеш
Работа с файлами в процессах происходит через файловый кеш. Например, мы открываем текстовый файл с помощью тексового редактора, данные это файла загружаются в оперативную память через кеш. Когда мы что-то меняем в файле, то у нас возникает несоответствие данных в памяти и на диске. Эти данные называются грязными  траницами. По сути это данные в cache которые еще не сброшены на диск. Команда sync принудительно сбросит грязные страницы на диск

#### Анонимный кеш
Anon cache - страницы памяти занятые во время работы программы и которые не отображаются на диске 


Информация о памяти
```shell
cat /proc/meminfo
```

Посмотреть информацию об ОП можно с помощью утилиты free.
Описание полей утилиты free:
- total - общая память минус то что занимает ядро.
- used - память которую занимают исполняющиеся процессы.
- free - ненужная в данный момент память (линукс использует почти всю доступную память для работы)
- shared - разделяемая памать для межпроцессного взаимодействия
- buff/cache - страничный кеш, все операции с файлами работают через кеш. После завершения работы какого либо процесса, данные из кеша не выгружаются, потому что читать их потом опять с диска долго и дорого. Ядро считает что эти данные могут понадобиться кому-то еще и не выгружает.
- available - доступная память, грубо можно сказать что это free + 70% cache.

Сбросить кеш можно командой, но это не обязательно:
``` shell
sudo su -c "echo 3 > /proc/sys/vm/drop_caches"
```

Swap - в своп попадают только анонимные страницы, которые мы не можем выгрузить на диск

/proc/sys/vm/swappiness - отношение файлового кеша к анонимному. По умолчанию равно 60. Для меньшего использования swap нужно уменьшать это значение плоть до 0, а при большем задейстовании swap можно увеличить до 100.
/proc/zoneinfo 

```shell
sysctl -a 2> /dev/null | grep swap
```