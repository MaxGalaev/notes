### Как устроен Loki

`Loki` это система сбор логов работающая по модели `push`.  На сервере, на котором нужно собирать логи устанавливается агент, который отправляет логи на сервер `Loki`. В качестве агента может выступать такой компонент как `promtail`. Он может работать как демон или например как докер контейнер. Этот агент скрапирует логи, добавляет лейблы и пушит это все на `Loki` через http. 

`Loki` хранит данные в видет чанков(`chank`). Чанк это сжатый набор строк из лога. 
В качестве `storage` может выступать файловая система или `s3` хранилище, что является предпочитаемым вариантом. 

В отличие от `ELK` `Loki` индексирует только заголовки логов вместе с лейблами, а не все сообщение. За счет этого экономится место и ускоряется работа. Это собственно основное преимущество. 

По факту `Loki` это один бинарник написанный на `go`. Он может запускаться в обычном, не кластерно режиме и все его внутренние компоненты, реализованы в одном этом бинарнике. Однако, если `Loki` запускается как микросервисное приложение (бинарник один, но с разными ключами запуска), он состоит из нескольких компонентов. Их можно условно поделить на 2 группы: первая это компоненты записи, а вторая это компоненты чтения. К первой относятся `Distibutor` и `Ingester`, а ко второй `Query Frontend` и `Querier`. Все они могут запускаться в нескольких экземплярах для распределения нагрузки. 

![[loki_architecture.png]]